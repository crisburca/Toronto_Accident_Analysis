---
title: "My title"
subtitle: "My subtitle if needed"
author: Cristina Burca
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format:
  pdf:
    documentclass: article
    geometry: margin = 1in
number-sections: true
toc: true
---

```{r} 
#| echo: false
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(dplyr)
library(sf)
library(tmap)
library(osmdata)
library(purrr)
library(ggmap)
library(knitr)
library(lubridate)
library(janitor)
library(ggmap)
```


```{r}
#| echo: false
#| include: false
#| warning: false
#| message: false

#load data
data <- read.csv("Motor Vehicle Collisions with KSI Data - 4326.csv")
```

# Introduction

Toronto is infamous for its heavy traffic, having one of the busiest highways in North America. With high amounts of traffic, also comes a lot of accidents. This paper was written with the purpose of compiling information of hotspot automobile accidents in the Toronto Region, to locate high traffic and high accident areas. Furthermore, this information assists in identifying the reasons for these accidents, whether it be distracted driving, or infrastructure related. 

- which neighbour hoods and intersections in toronto experience the most car accidents?


```{r}
#| echo: false
#| include: false
#| warning: false
#| message: false

# clean data
clean_data <- data %>% 
  filter(AUTOMOBILE == "Yes" | MOTORCYCLE == "Yes" | TRUCK== "Yes" |TRSN_CITY_VEH == "Yes" | EMERG_VEH == "Yes") %>%
  select(DATE, TIME, STREET1, STREET2, INJURY, DRIVACT, PEDACT, CYCACT, HOOD_158, geometry) %>%
  filter(!is.na(geometry))

#extract coordinates
clean_data <- clean_data %>%
  mutate(
    geometry_clean = gsub(".*\\[\\[(-?[0-9.]+),\\s*(-?[0-9.]+)\\].*", "\\1,\\2", geometry))
clean_data <- clean_data %>%
  separate(geometry_clean, into = c("longitude", "latitude"), sep = ",", convert = TRUE)
```


# 2. Data 

The data is sourced from the City of Toronto Open Data, a portal containing Licensed official data of Toronto. Used R to compile this paper as well as packages….

# 2.1 Introduction to the Data 

This Data consists of 18,763 observations of automobile accidents in the Region of Toronto from 2006 to September 2024.
 It consists of 6 variables of interest, including
 `Date`, 
`Time`,
 `Street 1`,
 `Street 2`, where the intersection (or nearest intersection) was to the accident, 
 `Injury` identifying if injuries occurred and their severity,
 `geometry` containing the latitude and longitude of the accident. 
This data was cleaned to have the term ‘automobile’ accidents  include any accidents involving cars, trucks, motorcycles, transit vehicles or emergency vehicles. Accidents where pedestrians or cyclists are involved are also included. 

- each point of accident is counted on the map, if multiple accidents happen, bubble is bigger 

In @fig-accident_overview, the map shows clusters of accidents across the city of Toronto. Darker circles show a denser area of accidents, and lighter circles show less dense areas of accidents. Most accidents happen along major roads, intersections, and densly populated areas. Many accidents occur Downtown Toronto, located at the bottom center of the map, as well as on the far right of the map near the intersections of the highways 427, 401 adn 409, on the right side of the map surrounding Scarborough, and finally along Steeles Ave, which is the uppermost highlighted street on the map. 

```{r,fig.width= 10, fig.height= 10}
#| echo: false
#| warning: false
#| message: false
#| label: fig-accident_overview
#| fig-cap: "somethinf"

# Group by longitude and latitude, count number of accidents by intersection, filter top 5 neighborhoods
accident_density <- clean_data %>%
  group_by(longitude, latitude) %>%
  summarise(accident_count = n())

sf_accident_density <- st_as_sf(accident_density, coords = c("longitude", "latitude"), crs = 4326)

accidents_top5 <- sf_accident_density %>%
  filter(accident_count >= 5)

# Define the boundary of Toronto, get Toronto map
bbox <- c(left = -79.6393, bottom = 43.5804, right = -79.1152, top = 43.8555)

toronto_stadia_map <- get_stadiamap(bbox = bbox, zoom = 11, maptype = "stamen_toner_lite")


# Plot map
ggmap(toronto_stadia_map) +
  geom_point(
    data = accidents_top5,
    aes(x = st_coordinates(geometry)[, 1], y = st_coordinates(geometry)[, 2], size = accident_count, color = accident_count),
    alpha = 0.5
  ) +
  scale_size_continuous(range = c(1, 9)) +
   scale_color_gradient(low = "pink", high = "blue") + 
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count",
       title = "High-Density Accident Points in Toronto") +
  theme_minimal() +
  guides(size = "none")
```

In @fig-accident_top10, the top 10 neighborhoods with the most accidents have been displayed to compare the number as well as the severity of the accidents. These numbers correlate to the following nieghbourhoods:

*put an image of toronto with major highways, roads nad divided by hood*

1- West Humber- Clairville, Etobicoke
119- Wexford/Maryvale Scarborough
20- Alderwood, Etboicoke, Alderwood
30- Brookhaven- Amesbury, North York
166- 
70-  South Riverdale, Old City of Toronto
170- Yonge- Bay Corridor, Old City of Toronto, Bay Street, Financial District
73- Moss Park- Old City of Toronto, Moss Park, Corktown and Garden District
78- Kensington- Chinatown, Old City of Toronto, Alexandra Park, Chinatown, Grange Park, Kensington Market
85- South Parkdale-  Old City of Toronto, Parkdale, South Parkdale

Noticeably, neighbourhood 1 has the most accidents occurred, by almost 200 accidents.Proportionally, neighbourhood 1 also experiences higher severity accidents. 


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-accident_top5
#| fig-cap: "somethinf"

# Summarize total accidents by neighborhood
top_hoods <- clean_data %>%
  group_by(HOOD_158) %>%
  summarise(total_accidents = n()) %>%
  arrange(desc(total_accidents)) %>%
  slice(1:5)

# Filter original data
top_5_hoods <- clean_data %>%
  filter(HOOD_158 %in% top_hoods$HOOD_158) %>%
  group_by(longitude, latitude, HOOD_158) %>% 
  summarise(accident_count =n())

# Bar chart of accidents by top 5 neighborhoods
ggplot(top_5_hoods, aes(x = factor(HOOD_158), y = accident_count)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Neighborhood", y = "Number of Accidents", fill = "Severity", 
       title = "Top 5 Neighborhoods by Accidents") +
  theme_minimal() +
  coord_flip()

```


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-top5
#| fig-cap: "somethinf"

# Define boundary of Toronto
bbox_toronto <- c(left = -79.665, bottom = 43.61, right = -79.25, top = 43.78)
toronto_map <- get_stadiamap(bbox = bbox_toronto, zoom = 12, maptype = "stamen_toner_lite")

# Plot map accident points of top 5 neighborhoods
ggmap(toronto_map) +
  geom_point(
    data = top_5_hoods, 
    aes(x = longitude, y = latitude, size = accident_count, color = accident_count),
    alpha = 0.7
  ) +
  scale_size_continuous(range = c(2, 9)) +  # Adjust the size of points based on accident count
  scale_color_gradient(low = "cadetblue3", high = "darkmagenta") +  # Color scale
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count", 
       title = "Accidents by Neighborhood (14:00-20:00)") +
  theme_minimal()

```


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-hood1
#| fig-cap: "NEIGHBOURHOOD 1"


# Define the bounding box for West Toronto
bbox_west <- c(left = -79.64, bottom = 43.67, right = -79.54, top = 43.76)

west_toronto_map <- get_stadiamap(bbox = bbox_west, zoom = 15, maptype = "stamen_toner_lite")

# Plot the map for West Toronto
ggmap(west_toronto_map) +
  geom_point(
    data = top_5_hoods, 
    aes(x = longitude, y = latitude, size = accident_count, color = accident_count),
    alpha = 0.7
  ) +
  scale_size_continuous(range = c(1,9)) +  
  scale_color_gradient(low = "cadetblue3", high = "darkmagenta") +  
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count", 
       title = "Accidents in West Toronto") +
  theme_minimal() +
  guides(size = "none")
```



```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-hood170
#| fig-cap: "NEIGHBOURHOOD 170"

# Define the bounding box for Downtown Toronto
bbox_downtown <- c(left = -79.397, bottom = 43.643, right = -79.373, top = 43.663)
# Fetch the map tiles for Downtown Toronto
downtown_toronto_map <- get_stadiamap(bbox = bbox_downtown, zoom = 15, maptype = "stamen_toner_lite")

# Plot the map for Downtown Toronto
ggmap(downtown_toronto_map) +
  geom_point(
    data = top_5_hoods, 
    aes(x = longitude, y = latitude, size = accident_count, color = accident_count),
    alpha = 0.55  # Increase transparency to reduce overlap effect
  ) +
  scale_size_continuous(range = c(2, 7)) +  # Smaller point sizes to reduce overlap
  scale_color_gradient(low = "lightblue", high = "purple") +
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count", 
       title = "Accidents in Downtown") +
  theme_minimal() +
  guides(size = "none")

```


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-hood119
#| fig-cap: "NEIGHBOURHOOD 119"

# Define the bounding box for East Toronto
# Define the bounding box for East Toronto (adjusting the left and right to capture more of the area)
bbox_east <- c(left = -79.33, bottom = 43.72, right = -79.27, top = 43.775)

# Fetch the map tiles for East Toronto
# Fetch the map tiles with a slightly lower zoom level
east_toronto_map <- get_stadiamap(bbox = bbox_east, zoom = 15, maptype = "stamen_toner_lite")


# Plot the map for East Toronto
ggmap(east_toronto_map) +
  geom_point(
    data = top_5_hoods, 
    aes(x = longitude, y = latitude, size = accident_count, color = accident_count),
    alpha = 0.7
  ) +
  scale_size_continuous(range = c(2, 9)) +  
  scale_color_gradient(low = "cadetblue3", high = "darkmagenta") +  
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count", 
       title = "Accidents in East Toronto") +
  theme_minimal() +
  guides(size = "none")
```
```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-hood70
#| fig-cap: "NEIGHBOURHOOD 119"

# Bounding box for the bottom left neighborhood (Etobicoke)
bbox_southwest <- c(left = -79.453, bottom = 43.625, right = -79.419, top = 43.648)

southwest_map <- get_stadiamap(bbox = bbox_southwest, zoom = 15, maptype = "stamen_toner_lite")

ggmap(southwest_map) +
  geom_point(
    data = top_5_hoods,  # Ensure this data is filtered for Etobicoke neighborhoods
    aes(x = longitude, y = latitude, size = accident_count, color = accident_count),
    alpha = 0.7
  ) +
  scale_size_continuous(range = c(2, 9)) +
  scale_color_gradient(low = "cadetblue3", high = "darkmagenta") +
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count",
       title = "Accidents in Southwest Toronto (Etobicoke)") +
  theme_minimal() +
guides(size = "none")
```

```{r}
#| echo: false
#| warning: false
#| message: false
# Bounding box for the bottom right neighborhood (Scarborough)
bbox_southeast <- c(left = -79.362, bottom = 43.633, right = -79.3, top = 43.678)

southeast_map <- get_stadiamap(bbox = bbox_southeast, zoom = 15, maptype = "stamen_toner_lite")


ggmap(southeast_map) +
  geom_point(
    data = top_5_hoods,  # Ensure this data is filtered for Scarborough neighborhoods
    aes(x = longitude, y = latitude, size = accident_count, color = accident_count),
    alpha = 0.7
  ) +
  scale_size_continuous(range = c(2, 9)) +
  scale_color_gradient(low = "cadetblue3", high = "darkmagenta") +
  labs(x = "Longitude", y = "Latitude", color = "Accident Count", size = "Accident Count",
       title = "Accidents in Southeast Toronto (Scarborough)") +
  theme_minimal() +
guides(size = "none")
```

